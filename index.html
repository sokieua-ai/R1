<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertical Farming Vocabulary Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            --card-bg: rgba(255, 255, 255, 0.98);
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --success: #00b894;
            --error: #d63031;
            --text: #2d3436;
            --shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 850px;
            background: var(--card-bg);
            border-radius: 28px;
            padding: 35px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .screen { display: none; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1 { text-align: center; margin-bottom: 25px; color: var(--primary); font-size: 2rem; }

        /* TRANG 1: T·ª™ V·ª∞NG */
        .vocab-header { display: flex; gap: 12px; margin-bottom: 20px; position: sticky; top: 0; background: var(--card-bg); padding: 10px 0; z-index: 100; }
        #search-input { flex: 1; padding: 14px 20px; border-radius: 15px; border: 2px solid #edeff2; outline: none; font-size: 1rem; transition: 0.3s; }
        #search-input:focus { border-color: var(--secondary); box-shadow: 0 0 0 4px rgba(162, 155, 254, 0.1); }

        .vocab-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; max-height: 55vh; overflow-y: auto; padding: 5px; }
        .vocab-item { background: #fff; padding: 18px; border-radius: 18px; border: 1px solid #f0f2f5; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .vocab-item:hover { transform: translateY(-3px); border-color: var(--secondary); box-shadow: 0 8px 15px rgba(0,0,0,0.05); }
        .speaker-btn { background: #f3f0ff; border: none; width: 45px; height: 45px; border-radius: 12px; cursor: pointer; font-size: 20px; color: var(--primary); transition: 0.2s; }
        .speaker-btn:hover { background: var(--primary); color: white; }

        .btn-main { background: var(--primary); color: white; width: 100%; padding: 18px; border-radius: 15px; border: none; cursor: pointer; font-weight: 700; font-size: 1.1rem; margin-top: 25px; transition: 0.3s; }
        .btn-main:hover { background: #5b4bc4; transform: scale(1.01); box-shadow: 0 10px 20px rgba(108, 92, 231, 0.2); }

        /* TRANG 2: QUIZ */
        .progress-bar-bg { width: 100%; height: 10px; background: #edeff2; border-radius: 10px; margin-bottom: 30px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.4s; }
        
        .question-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 25px; line-height: 1.4; text-align: center; }
        .options-list { display: grid; gap: 12px; }
        .opt-btn { padding: 18px; border: 2px solid #edeff2; border-radius: 16px; background: white; text-align: left; font-size: 1.05rem; cursor: pointer; transition: 0.2s; position: relative; }
        
        /* Hi·ªáu ·ª©ng ch·ªçn ƒë√°p √°n */
        .opt-btn.correct { background: var(--success) !important; color: white; border-color: var(--success); }
        .opt-btn.wrong { background: var(--error) !important; color: white; border-color: var(--error); }
        .opt-btn:disabled { cursor: default; }

        .input-area { text-align: center; }
        .fill-box { width: 100%; padding: 18px; font-size: 1.2rem; border: 2px solid #edeff2; border-radius: 16px; outline: none; margin-bottom: 15px; text-align: center; }
        .fill-box.correct { border-color: var(--success); background: #e6faf4; }
        .fill-box.wrong { border-color: var(--error); background: #fff1f1; }
        
        .feedback-text { font-weight: 700; margin-top: 15px; height: 24px; text-align: center; }

        /* TRANG 3: T·ªîNG K·∫æT */
        .score-display { text-align: center; margin: 20px 0; }
        .score-num { font-size: 4rem; font-weight: 800; color: var(--primary); }
        .review-container { max-height: 400px; overflow-y: auto; margin-top: 30px; padding-right: 10px; }
        .review-card { padding: 15px; border-radius: 15px; margin-bottom: 12px; border-left: 6px solid #ccc; background: #f8f9fa; }
        .review-card.is-ok { border-left-color: var(--success); background: #f0fffb; }
        .review-card.is-not-ok { border-left-color: var(--error); background: #fff8f8; }
    </style>
</head>
<body>

<div class="container">
    <section id="screen-vocab" class="screen active">
        <h1>Vertical Farming Hub</h1>
        <div class="vocab-header">
            <input type="text" id="search-input" placeholder="T√¨m ki·∫øm t·ª´ ho·∫∑c nghƒ©a...">
        </div>
        <div class="vocab-list" id="vocab-display"></div>
        <button class="btn-main" onclick="startQuiz()">B·∫Øt ƒë·∫ßu √¥n t·∫≠p (40 c√¢u)</button>
    </section>

    <section id="screen-quiz" class="screen">
        <div class="progress-bar-bg"><div class="progress-bar-fill" id="pb-fill"></div></div>
        <div id="quiz-area"></div>
        <div id="feedback" class="feedback-text"></div>
    </section>

    <section id="screen-result" class="screen">
        <h1>Ho√†n th√†nh b√†i t·∫≠p!</h1>
        <div class="score-display">
            <div class="score-num" id="res-score">0/40</div>
            <p id="res-rank" style="font-weight: 600; font-size: 1.2rem;"></p>
        </div>
        <button class="btn-main" onclick="location.reload()">H·ªçc l·∫°i t·ª´ ƒë·∫ßu üîÅ</button>
        <div class="review-container" id="res-details"></div>
    </section>
</div>

<script>
    // D·ªÆ LI·ªÜU G·ªêC T·ª™ FILE C·ª¶A B·∫†N
    const vocabulary = [
        { en: "By the year", vi: "Tr∆∞·ªõc nƒÉm" }, { en: "Urban centre", vi: "Trung t√¢m ƒë√¥ th·ªã" },
        { en: "Conservative estimates", vi: "Nh·ªØng ∆∞·ªõc t√≠nh d√® d·∫∑t" }, { en: "Demographics", vi: "D√¢n s·ªë h·ªçc" },
        { en: "Current Demographic Trends", vi: "Xu h∆∞·ªõng d√¢n s·ªë h·ªçc hi·ªán t·∫°i" }, { en: "Traditional farming method", vi: "Ph∆∞∆°ng ph√°p canh t√°c truy·ªÅn th·ªëng" },
        { en: "Raising crop", vi: "Tr·ªìng tr·ªçt" }, { en: "To be in vogue", vi: "ƒêang th·ªãnh h√†nh" },
        { en: "To lay sth to waste", vi: "Ph√° h·ªßy ho√†n to√†n c√°i g√¨" }, { en: "Poor management practice", vi: "C√°ch qu·∫£n l√Ω y·∫øu k√©m" },
        { en: "To live on sth", vi: "S·ªëng d·ª±a v√†o c√°i g√¨" }, { en: "Indoor farming", vi: "Tr·ªìng tr·ªçt trong nh√†" },
        { en: "The urgent need to do sth", vi: "Nhu c·∫ßu c·∫•p b√°ch l√†m g√¨" }, { en: "An entirely new approach", vi: "M·ªôt c√°ch ti·∫øp c·∫≠n ho√†n to√†n m·ªõi" },
        { en: "Cutting-edge technology", vi: "C√¥ng ngh·ªá ti√™n ti·∫øn nh·∫•t" }, { en: "Vertical farm", vi: "Trang tr·∫°i d·ªçc" },
        { en: "Horizontal farming", vi: "Canh t√°c theo chi·ªÅu ngang" }, { en: "Multi storey", vi: "Nhi·ªÅu t·∫ßng" },
        { en: "Environmentally controlled conditions", vi: "ƒêi·ªÅu ki·ªán m√¥i tr∆∞·ªùng ƒë∆∞·ª£c ki·ªÉm so√°t" }, { en: "To be situated in", vi: "·ªû ƒë√¢u ƒë√≥ / T·ªça l·∫°c t·∫°i" },
        { en: "Proponent", vi: "Ng∆∞·ªùi ·ªßng h·ªô" }, { en: "Urban renewal", vi: "C·∫£i c√°ch ƒë√¥ th·ªã" },
        { en: "Sustainable production", vi: "S·∫£n xu·∫•t b·ªÅn v·ªØng" }, { en: "Year-round production", vi: "Canh t√°c quanh nƒÉm" },
        { en: "To be sacrificed for sth", vi: "B·ªã hy sinh cho c√°i g√¨" }, { en: "Take sth for granted", vi: "Coi c√°i g√¨ l√† hi·ªÉn nhi√™n" },
        { en: "Despoil", vi: "C∆∞·ªõp b√≥c, chi·∫øm ƒëo·∫°t" }, { en: "To turn sth into sth", vi: "Bi·∫øn c√°i g√¨ th√†nh c√°i g√¨" },
        { en: "Verdant, natural ecozone", vi: "V√πng sinh th√°i t·ª± nhi√™n t∆∞∆°i t·ªët" }, { en: "Semi-arid desert", vi: "Sa m·∫°c b√°n kh√¥ c·∫±n" },
        { en: "Within the same time frame", vi: "C√πng trong kho·∫£ng th·ªùi gian ƒë√≥" }, { en: "Elements", vi: "ƒêi·ªÅu ki·ªán th·ªùi ti·∫øt (kh·∫Øc nghi·ªát)" },
        { en: "To subject A to B", vi: "B·∫Øt A ph·∫£i ch·ªãu ƒë·ª±ng B" }, { en: "Food-bearing plants", vi: "C√¢y l∆∞∆°ng th·ª±c" },
        { en: "No more than hope for", vi: "Kh√¥ng th·ªÉ l√†m g√¨ h∆°n ngo√†i hy v·ªçng" }, { en: "Massive flood", vi: "Tr·∫≠n l≈© l·ªõn" },
        { en: "A long drought", vi: "H·∫°n h√°n k√©o d√†i" }, { en: "Hurricane", vi: "Cu·ªìng phong" },
        { en: "Severe monsoons", vi: "Gi√≥ m√πa kh·∫Øc nghi·ªát" }, { en: "Valuable crops", vi: "V·ª• m√πa gi√° tr·ªã" },
        { en: "Weather-related crop failures", vi: "Th·∫•t b√°t m√πa m√†ng do th·ªùi ti·∫øt" }, { en: "To eliminate the need for", vi: "Lo·∫°i b·ªè nhu c·∫ßu cho c√°i g√¨" },
        { en: "Infectious disease", vi: "B·ªánh truy·ªÅn nhi·ªÖm" }, { en: "Acquire", vi: "Thu nh·∫≠n / ƒê·∫°t ƒë∆∞·ª£c" },
        { en: "Consume energy", vi: "Ti√™u th·ª• nƒÉng l∆∞·ª£ng" }, { en: "To appear to", vi: "D∆∞·ªùng nh∆∞" },
        { en: "Variation", vi: "Bi·∫øn th·ªÉ / D·∫°ng" }, { en: "More need to be done", vi: "C·∫ßn l√†m nhi·ªÅu h∆°n n·ªØa" }
    ];

    let quizList = [];
    let currentIdx = 0;
    let score = 0;
    let userLogs = [];

    // --- TI·ªÜN √çCH ---
    function playAudio(isCorrect) {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        if (isCorrect) {
            oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
        } else {
            oscillator.frequency.setValueAtTime(220, audioCtx.currentTime); // A3
            oscillator.frequency.linearRampToValueAtTime(110, audioCtx.currentTime + 0.2);
        }
        oscillator.start();
        gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.5);
        oscillator.stop(audioCtx.currentTime + 0.5);
    }

    function speak(text) {
        const synth = window.speechSynthesis;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'en-US';
        synth.speak(utter);
    }

    // --- M√ÄN H√åNH T·ª™ V·ª∞NG ---
    function renderVocab(list = vocabulary) {
        const display = document.getElementById('vocab-display');
        display.innerHTML = list.map(item => `
            <div class="vocab-item">
                <div>
                    <strong style="color:var(--primary); font-size:1.1rem">${item.en}</strong><br>
                    <span style="color:#636e72">${item.vi}</span>
                </div>
                <button class="speaker-btn" onclick="speak('${item.en}')">üîä</button>
            </div>
        `).join('');
    }

    document.getElementById('search-input').addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        const filtered = vocabulary.filter(v => v.en.toLowerCase().includes(val) || v.vi.toLowerCase().includes(val));
        renderVocab(filtered);
    });

    // --- QUIZ LOGIC ---
    function startQuiz() {
        // Tr·ªôn ng·∫´u nhi√™n 40 c√¢u t·ª´ 48 t·ª´
        const shuffled = [...vocabulary].sort(() => 0.5 - Math.random());
        quizList = shuffled.slice(0, 40).map((item, i) => {
            const type = i < 20 ? 'MCQ' : 'FILL'; // 20 c√¢u tr·∫Øc nghi·ªám, 20 c√¢u ƒëi·ªÅn t·ª´
            const options = type === 'MCQ' ? 
                [item.vi, ...vocabulary.filter(v => v.vi !== item.vi).sort(() => 0.5 - Math.random()).slice(0,3).map(v => v.vi)].sort(() => 0.5 - Math.random()) 
                : [];
            return { ...item, type, options };
        });
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('screen-quiz').classList.add('active');
        showQuestion();
    }

    function showQuestion() {
        const q = quizList[currentIdx];
        const area = document.getElementById('quiz-area');
        const feedback = document.getElementById('feedback');
        feedback.innerText = "";
        document.getElementById('pb-fill').style.width = `${(currentIdx / 40) * 100}%`;

        if (q.type === 'MCQ') {
            area.innerHTML = `
                <div class="question-title">C√¢u ${currentIdx+1}/40: Nghƒ©a c·ªßa "<span style="color:var(--primary)">${q.en}</span>" l√† g√¨?</div>
                <div class="options-list">
                    ${q.options.map(opt => `<button class="opt-btn" onclick="handleMCQ(this, '${opt}')">${opt}</button>`).join('')}
                </div>
            `;
        } else {
            area.innerHTML = `
                <div class="question-title">C√¢u ${currentIdx+1}/40: Vi·∫øt t·ª´ ti·∫øng Anh t∆∞∆°ng ·ª©ng:</div>
                <div style="text-align:center; font-size:1.5rem; font-weight:700; color:var(--primary); margin-bottom:20px">${q.vi}</div>
                <div class="input-area">
                    <input type="text" id="user-input" class="fill-box" placeholder="G√µ ƒë√°p √°n..." autofocus autocomplete="off">
                    <button class="btn-main" id="submit-btn" onclick="handleFill()">G·ª≠i ƒë√°p √°n</button>
                    <p style="color:#636e72; margin-top:10px">G·ª£i √Ω: ${q.en.charAt(0)}... (${q.en.length} k√Ω t·ª±)</p>
                </div>
            `;
            document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') handleFill(); });
        }
    }

    function handleMCQ(btn, selected) {
        const q = quizList[currentIdx];
        const isCorrect = (selected === q.vi);
        const feedback = document.getElementById('feedback');
        const allBtns = document.querySelectorAll('.opt-btn');

        allBtns.forEach(b => {
            b.disabled = true; // Ch·ªëng b·∫•m nhi·ªÅu l·∫ßn
            if (b.innerText === q.vi) b.classList.add('correct');
        });

        if (isCorrect) {
            score++;
            playAudio(true);
            feedback.innerText = "Ch√≠nh x√°c! ‚ú®";
            feedback.style.color = "var(--success)";
        } else {
            btn.classList.add('wrong');
            playAudio(false);
            feedback.innerText = "Sai r·ªìi! üò¢";
            feedback.style.color = "var(--error)";
        }

        saveLog(q.en, selected, q.vi, isCorrect);
        setTimeout(nextStep, 1200); // Chuy·ªÉn c√¢u sau 1.2s ƒë·ªÉ h·ªçc sinh nh√¨n ƒë√°p √°n
    }

    function handleFill() {
        const input = document.getElementById('user-input');
        const btn = document.getElementById('submit-btn');
        const q = quizList[currentIdx];
        const val = input.value.trim();
        const isCorrect = (val.toLowerCase() === q.en.toLowerCase());
        const feedback = document.getElementById('feedback');

        input.disabled = true;
        btn.disabled = true;

        if (isCorrect) {
            score++;
            input.classList.add('correct');
            playAudio(true);
            feedback.innerText = "Tuy·ªát v·ªùi! üî•";
            feedback.style.color = "var(--success)";
        } else {
            input.classList.add('wrong');
            playAudio(false);
            feedback.innerText = `Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: ${q.en}`;
            feedback.style.color = "var(--error)";
        }

        saveLog(q.vi, val || "(Tr·ªëng)", q.en, isCorrect);
        setTimeout(nextStep, 2000); // C√¢u ƒëi·ªÅn t·ª´ ƒë·ªÉ l√¢u h∆°n ch√∫t (2s) ƒë·ªÉ nh√¨n l·ªói ch√≠nh t·∫£
    }

    function saveLog(q, u, c, ok) {
        userLogs.push({ q, u, c, ok });
    }

    function nextStep() {
        currentIdx++;
        if (currentIdx < 40) showQuestion();
        else showFinal();
    }

    function showFinal() {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('screen-result').classList.add('active');
        document.getElementById('res-score').innerText = `${score}/40`;
        
        let rank = "";
        if(score >= 36) rank = "Master üåü (Xu·∫•t s·∫Øc)";
        else if(score >= 28) rank = "Advanced üí™ (Gi·ªèi)";
        else if(score >= 20) rank = "Improving üìò (Kh√°)";
        else rank = "Beginner üå± (C·∫ßn c·ªë g·∫Øng)";
        document.getElementById('res-rank').innerText = rank;

        const details = document.getElementById('res-details');
        details.innerHTML = userLogs.map((log, i) => `
            <div class="review-card ${log.ok ? 'is-ok' : 'is-not-ok'}">
                <strong>C√¢u ${i+1}: ${log.q}</strong><br>
                <span>C·ªßa b·∫°n: <span style="color:${log.ok ? 'green' : 'red'}">${log.u}</span></span><br>
                ${!log.ok ? `<span>ƒê√°p √°n ƒë√∫ng: <b style="color:green">${log.c}</b></span>` : ''}
            </div>
        `).join('');
    }

    renderVocab();
</script>
</body>
</html>
